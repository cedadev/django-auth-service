# Django Auth Service

Django application for authenticating and authorizing user sessions.

Designed to work in tandem with an Nginx server using the auth_request module
to authorize access to resources.

## Authentication settings

- `authenticate.oauth2.middleware.BearerTokenAuthenticationMiddleware`

  Authenticates requests based on the presence of an [OAuth2](https://oauth.net/2/) Bearer Token.

  Requires the following settings:

  - `OAUTH_CLIENT_ID` - The ID of your OAuth2 client.
  - `OAUTH_CLIENT_SECRET` The secret associated with your OAuth2 client.
  - `OAUTH_TOKEN_URL` - An endpoint on the OAuth2 server used to fetch a token.
  - `OAUTH_TOKEN_INTROSPECT_URL` - The OAuth2 server's token introspection endpoint. Used to determine token validity.

- `authenticate.oidc.middleware.OpenIDConnectAuthenticationMiddleware`

  Authenticates requests using an OpenID Connect authentication flow.

  This middleware makes use of [Authlib](https://pypi.org/project/Authlib/). See the Authlib documentation for help with [configuration](https://docs.authlib.org/en/latest/client/django.html#configuration).

- `authenticate.cookie.middleware.CookieAuthenticationMiddleware`

  Authenticates requests based on the presence of an encrypted cookie generated by the [crypto-cookie](https://pypi.org/project/crypto-cookie/) package.

  Requires the following settings:

  - `ACCOUNT_COOKIE_NAME` - The name of the cookie.
  - `SECURITY_SHAREDSECRET` - The Base64 encoded secret used to encrypt the cookie.

## Authorization Settings

There are two middleware classes that can be added to a Django application's `MIDDLEWARE` setting:

- `authorize.middleware.saml.SAMLAuthorizationMiddleware`

  A middleware which queries a SAML authorization server to determine if a user is permitted access to the requested resource.

  This middleware requires an authorization service endpoint specified by the `AUTHORIZATION_SERVICE_URL` setting.

- `authorize.middleware.LoginAuthorizationMiddleware`

  A simple middleware that will authorize any request that has been successfully authenticated.

### Bybassing authorization

The `AUTHORIZATION_EXEMPT_FILTER` setting can be assigned a function used to determine whether a request is exempt from authorization. e.g.

  ```python
  def exempt_all(request):
      return True

  AUTHORIZATION_EXEMPT_FILTER = exempt_all
  ```
